---
import { Icon } from "astro-icon/components";

import A from "@/components/a.astro";
import { links } from "@/config/navigation.config";

const nav_links = [links.nestroylang, links.projectvienna, links.entities, links.team];
---

<header class="border-b-4 border-brand-background bg-surface-background text-surface-foreground">
	<div class="container flex justify-between">
		<div class="flex items-center gap-4 text-base sm:text-lg">
			<a
				aria-label={links.home.label}
				class="inline-flex items-center gap-2 transition hover:text-muted-foreground"
				href={links.home.href}
			>
				<img alt="" class="h-20" src="/assets/images/nca_logo.png" />
			</a>

			<nav aria-label="Primary navigation">
				<ul class="hidden lg:flex lg:items-center lg:gap-4" role="list">
					{
						Object.entries(nav_links).map(([, link]) => {
							return (
								<li>
									<A
										class="inline-flex transition hover:text-muted-foreground"
										href={link.href}
										rel="prefetch"
									>
										{link.label}
									</A>
								</li>
							);
						})
					}
				</ul>
			</nav>
		</div>

		<div class="flex items-center gap-4">
			<nav aria-label="Primary navigation" class="inline-flex items-center lg:hidden">
				<button aria-controls="navigation-menu" aria-expanded="true" data-menu-toggle>
					<span class="sr-only">Toggle navigation menu</span>
					<Icon aria-hidden="true" class="h-5 w-5 shrink-0" name="lucide:menu" />
				</button>
			</nav>
		</div>
	</div>

	<div
		class="data-[state='open']:block data-[state='closed']:hidden lg:hidden lg:data-[state]:hidden"
		data-state="open"
		id="navigation-menu"
	>
		<div
			class="container flex flex-wrap items-center justify-between gap-x-8 gap-y-4 border-t py-8"
		>
			<ul class="flex flex-col gap-4" role="list">
				{
					Object.entries(links).map(([, link]) => {
						return (
							<li>
								<a
									class="inline-flex transition hover:text-muted-foreground"
									href={link.href}
									rel="prefetch"
								>
									{link.label}
								</a>
							</li>
						);
					})
				}
			</ul>
		</div>
	</div>
</header>

<script>
	const button = document.querySelector<HTMLButtonElement>("[data-menu-toggle]")!;
	const menu = document.querySelector<HTMLDivElement>("#navigation-menu")!;

	close();

	function open() {
		// button.setAttribute("aria-controls", "navigation-menu");
		button.setAttribute("aria-expanded", "true");
		menu.dataset.state = "open";
	}

	function close() {
		// button.removeAttribute("aria-controls");
		button.setAttribute("aria-expanded", "false");
		menu.dataset.state = "closed";
	}

	button.addEventListener("click", () => {
		if (menu.dataset.state === "closed") {
			open();
		} else {
			close();
		}
	});

	const mediaQuery = window.matchMedia("(min-width: 992px)"); // `lg` breakpoint
	mediaQuery.addEventListener("change", (event) => {
		if (event.matches) {
			close();
		}
	});
</script>
